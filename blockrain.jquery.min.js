/*!
 * BlockRain.js 0.1.0
 * jQuery plugin that lets you put a playable (and configurable) game of Tetris in your site or just leave it in auto in the background.
 * http://aerolab.github.io/blockrain.js/
 *
 * Copyright (c) 2015 Aerolab <hey@aerolab.co>
 *
 * Released under the MIT license
 * http://aerolab.github.io/blockrain.js/LICENSE.txt
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){var e=0,i=Array.prototype.slice;t.cleanData=function(e){return function(i){var n,r,o;for(o=0;null!=(r=i[o]);o++)try{n=t._data(r,"events"),n&&n.remove&&t(r).triggerHandler("remove")}catch(s){}e(i)}}(t.cleanData),t.widget=function(e,i,n){var r,o,s,a,h={},c=e.split(".")[0];return e=e.split(".")[1],r=c+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][r.toLowerCase()]=function(e){return!!t.data(e,r)},t[c]=t[c]||{},o=t[c][e],s=t[c][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new s(t,e)},t.extend(s,o,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(n,function(e,n){return t.isFunction(n)?void(h[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},r=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=r,e=n.apply(this,arguments),this._super=i,this._superApply=o,e}}()):void(h[e]=n)}),s.prototype=t.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix||e:e},h,{constructor:s,namespace:c,widgetName:e,widgetFullName:r}),o?(t.each(o._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete o._childConstructors):i._childConstructors.push(s),t.widget.bridge(e,s),s},t.widget.extend=function(e){for(var n,r,o=i.call(arguments,1),s=0,a=o.length;a>s;s++)for(n in o[s])r=o[s][n],o[s].hasOwnProperty(n)&&void 0!==r&&(e[n]=t.isPlainObject(r)?t.isPlainObject(e[n])?t.widget.extend({},e[n],r):t.widget.extend({},r):r);return e},t.widget.bridge=function(e,n){var r=n.prototype.widgetFullName||e;t.fn[e]=function(o){var s="string"==typeof o,a=i.call(arguments,1),h=this;return o=!s&&a.length?t.widget.extend.apply(null,[o].concat(a)):o,this.each(s?function(){var i,n=t.data(this,r);return"instance"===o?(h=n,!1):n?t.isFunction(n[o])&&"_"!==o.charAt(0)?(i=n[o].apply(n,a),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+o+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+o+"'")}:function(){var e=t.data(this,r);e?(e.option(o||{}),e._init&&e._init()):t.data(this,r,new n(o,this))}),h}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(i,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=e++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===n&&this.destroy()}}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var n,r,o,s=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(s={},n=e.split("."),e=n.shift(),n.length){for(r=s[e]=t.widget.extend({},this.options[e]),o=0;n.length-1>o;o++)r[n[o]]=r[n[o]]||{},r=r[n[o]];if(e=n.pop(),1===arguments.length)return void 0===r[e]?null:r[e];r[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];s[e]=i}return this._setOptions(s),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,i,n){var r,o=this;"boolean"!=typeof e&&(n=i,i=e,e=!1),n?(i=r=t(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),t.each(n,function(n,s){function a(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var h=n.match(/^([\w:-]*)\s*(.*)$/),c=h[1]+o.eventNamespace,l=h[2];l?r.delegate(l,c,a):i.bind(c,a)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(i).undelegate(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var r,o,s=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(t.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?r===!0||"number"==typeof r?i:r.effect||i:e;r=r||{},"number"==typeof r&&(r={duration:r}),s=!t.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&t.effects&&t.effects.effect[a]?n[e](r):a!==e&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){t(this)[e](),o&&o.call(n[0]),i()})}}),t.widget}),$.fn.safekeypress=function(t,e){function i(t){var i=e.stopKeys[t.keyCode]||e.moreStopKeys&&e.moreStopKeys[t.keyCode];return i&&t.preventDefault(),i}function n(t){return"safekeypress."+t.keyCode}function r(e){var r=n(e),o=($.data(this,r)||0)+1;return $.data(this,r,o),o>0?t.call(this,e):i(e)}function o(e){var i=n(e);return $.data(this,i,($.data(this,i)||0)-1),t.call(this,e)}function s(t){return $.data(this,n(t),0),i(t)}return e=$.extend({stopKeys:{37:1,38:1,39:1,40:1}},e),$(this).keypress(r).keydown(o).keyup(s)},/*!
 * BlockRain.js 0.1.0
 * jQuery plugin that lets you put a playable (and configurable) game of Tetris in your site or just leave it in auto in the background.
 * http://aerolab.github.io/blockrain.js/
 *
 * Copyright (c) 2015 Aerolab <hey@aerolab.co>
 *
 * Released under the MIT license
 * http://aerolab.github.io/blockrain.js/LICENSE.txt
 */
function(t){"use strict";t.widget("aerolab.blockrain",{options:{autoplay:!1,showFieldOnStart:!0,theme:null,blockWidth:10,autoBlockWidth:!1,autoBlockSize:24,difficulty:"normal",playText:"Let's play some Tetris",playButtonText:"Play",gameOverText:"Game Over",restartButtonText:"Play Again",scoreText:"Score",onStart:function(){},onRestart:function(){},onGameOver:function(){}},_theme:{},_$game:null,_$canvas:null,_$gameholder:null,_$start:null,_$gameover:null,_$score:null,_$scoreText:null,_preloadThemeAssets:function(){if("undefined"!=typeof this._theme.blocks)for(var t=Object.keys(this._theme.blocks),e=new RegExp("^data:image/(png|gif|jpg);base64,","i"),i=0;i<t.length;i++)if(this._theme.blocks[t[i]],"string"==typeof this._theme.blocks[t[i]]&&e.test(this._theme.blocks[t[i]])){var n=this._theme.blocks[t[i]];this._theme.blocks[t[i]]=new Image,this._theme.blocks[t[i]].src=n}if("undefined"!=typeof this._theme.backgroundGrid&&"string"==typeof this._theme.backgroundGrid&&e.test(this._theme.backgroundGrid)){var n=this._theme.backgroundGrid;this._theme.backgroundGrid=new Image,this._theme.backgroundGrid.src=n}},_setTheme:function(){"string"==typeof this._theme&&(this._theme=BlockrainThemes[this._theme]),("undefined"==typeof this._theme||null===this._theme)&&(this._theme=BlockrainThemes.retro),(isNaN(parseInt(this._theme.strokeWidth))||"number"!=typeof parseInt(this._theme.strokeWidth))&&(this._theme.strokeWidth=2),this._preloadThemeAssets()},_createHolder:function(){this._$game=t(this),this._$gameholder=t('<div class="blockrain-game-holder"></div>'),this._$gameholder.css("position","relative").css("width","100%").css("height","100%"),this._$game.html("").append(this._$gameholder)},_createUI:function(){var e=t('<canvas style="display:block; width:100%; height:100%; padding:0; margin:0; border:none;" />');"string"==typeof this._theme.background&&e.css("background-color",this._theme.background),this._$gameholder.append(e),this._$score=t('<div class="blockrain-score-holder" style="position:absolute;"><div class="blockrain-score"><div class="blockrain-score-msg">'+this.options.scoreText+'</div><div class="blockrain-score-num">0</div></div></div>').hide(),this._$scoreText=this._$score.find(".blockrain-score-num"),this._$gameholder.append(this._$score),this._$start=t('<div class="blockrain-start-holder" style="position:absolute;"><div class="blockrain-start"><div class="blockrain-start-msg">'+this.options.playText+'</div><a class="blockrain-btn blockrain-start-btn">'+this.options.playButtonText+"</a></div></div>").hide(),this._$gameholder.append(this._$start),this._$start.find(".blockrain-start-btn").click(function(t){t.preventDefault(),startBoard(),this.options.onStart()}),this._$gameover=t('<div class="blockrain-game-over-holder" style="position:absolute;"><div class="blockrain-game-over"><div class="blockrain-game-over-msg">'+this.options.gameOverText+'</div><a class="blockrain-btn blockrain-game-over-btn">'+this.options.restartButtonText+"</a></div></div>").hide(),this._$gameover.find(".blockrain-game-over-btn").click(function(t){t.preventDefault(),startBoard(),this.options.onRestart()}),this._$gameholder.append(this._$gameover)},_refreshBlockSizes:function(){this.options.autoBlockWidth&&(this.options.blockWidth=Math.ceil(this._$game.width()/this.options.autoBlockSize))},_create:function(){function e(){A=this._$game.innerWidth(),p=this._$game.innerHeight(),m=Math.floor(A/f),A=m*f,p=m*g,v=2,$canvas.attr("width",A).attr("height",p)}function i(t,e){return t+Math.floor(Math.random()*(1+e-t))}function n(t){return t[i(0,t.length-1)]}function r(t){if(t=t||u,"string"==typeof this._theme.background){if(this._theme.backgroundGrid instanceof Image){if(0===this._theme.backgroundGrid.width||0===this._theme.backgroundGrid.height)return;t.globalAlpha=1;for(var e=0;f>e;e++)for(var i=0;g>i;i++){var n=e*m,r=i*m;t.drawImage(this._theme.backgroundGrid,0,0,this._theme.backgroundGrid.width,this._theme.backgroundGrid.height,n,r,m,m)}}else if("string"==typeof this._theme.backgroundGrid){{var o=this._theme.strokeWidth;Math.round(.23*m),Math.round(.3*m)}t.globalAlpha=1,t.fillStyle=this._theme.backgroundGrid;for(var e=0;f>e;e++)for(var i=0;g>i;i++){var n=e*m,r=i*m;t.fillRect(n+o,r+o,m-2*o,m-2*o)}}t.globalAlpha=1}}function o(t,e,i,n){n=n||u,t*=m,e*=m;var r=this._theme.strokeWidth,o=Math.round(.23*m),a=Math.round(.3*m),h=s(i,!1);if(n.globalAlpha=1,h instanceof Image){if(n.globalAlpha=1,0===h.width||0===h.height)return;n.drawImage(h,0,0,h.width,h.height,t,e,m,m)}else"string"==typeof h&&(n.fillStyle=h,n.fillRect(t,e,m,m),"string"==typeof this._theme.innerShadow&&(n.globalAlpha=1,n.strokeStyle=this._theme.innerShadow,n.lineWidth=1,n.strokeRect(t+1,e+1,m-2,m-2)),"string"==typeof this._theme.stroke&&(n.globalAlpha=1,n.fillStyle=this._theme.stroke,n.strokeStyle=this._theme.stroke,n.lineWidth=r,n.strokeRect(t,e,m,m)),"string"==typeof this._theme.innerStroke&&(n.fillStyle=this._theme.innerStroke,n.fillRect(t+o,e+o,m-2*o,r),n.fillRect(t+o,e+o+r,r,m-2*o-r)),"string"==typeof this._theme.innerSquare&&(n.fillStyle=this._theme.innerSquare,n.globalAlpha=.2,n.fillRect(t+a,e+a,m-2*a,m-2*a)));n.globalAlpha=1}function s(t,e){return"boolean"!=typeof e&&(e=!0),e?"string"==typeof this._theme.primary&&""!==this._theme.primary?this._theme.primary:this._theme.blocks[t]:"string"==typeof this._theme.secondary&&""!==this._theme.secondary?this._theme.secondary:this._theme.blocks[t]}function a(e,i,n){return t.extend(this,{x:0,y:0,symmetrical:i,init:function(){return t.extend(this,{orientation:0,x:Math.floor(f/2)-1,y:-1}),this},blockType:n,blocksLen:e[0].length,orientations:e,orientation:0,rotate:function(t){var e=(this.orientation+(t?1:-1)+4)%4;h(this.x,this.y,this.getBlocks(e))||(this.orientation=e)},moveRight:function(){h(this.x+1,this.y,this.getBlocks())||this.x++},moveLeft:function(){h(this.x-1,this.y,this.getBlocks())||this.x--},getBlocks:function(t){return this.orientations[void 0!==t?t:this.orientation]},draw:function(t,e,i,n,r){t&&this.y++;for(var s=this.getBlocks(n),a=void 0===e?this.x:e,h=void 0===i?this.y:i,c=0;c<this.blocksLen;c+=2)o(a+s[c],h+s[c+1],this.blockType,r)},getBounds:function(e){for(var i=t.isArray(e)?e:this.getBlocks(e),n=0,r=i.length,o=999,s=-999,a=999,h=-999;r>n;n+=2)i[n]<o&&(o=i[n]),i[n]>s&&(s=i[n]),i[n+1]<a&&(a=i[n+1]),i[n+1]>h&&(h=i[n+1]);return{left:o,right:s,top:a,bottom:h,width:s-o,height:h-a}}}),this.init()}function h(t,e,i,n){for(var r,o,s=0,a=i.length;a>s;s+=2){if(r=t+i[s],o=e+i[s+1],o>=g||w.check(r,o))return!0;if(!n&&0>r||r>=f)return!0}return!1}function c(){return w.clearAll(),w._resetScore(),C.started=!0,C.animate(),this._$start.fadeOut(150),this._$gameover.fadeOut(150),this._$score.fadeIn(150),!1}this._setTheme(this._theme),this._createHolder(),this._createUI(),this._refreshBlockSizes();var l=function(t,e){function i(t,i,n,r,o,s,a){var h,c,l,d,u=i.length,f=0,g={};for(h=0;u>h;h+=2)f+=t[o.asIndex(n+i[h],r+i[h+1])]||0;for(h=0;u>h;h+=2)c=i[h],l=i[h+1],(g[c]===e||g[c]<l)&&(g[c]=l);d=0;for(c in g)for(c=parseInt(c),l=g[c]+1,h=0;a>r+l;l++,h++)if(!o.check(n+c,r+l)){d+=0==h?2:1;break}return f-=d}function n(){for(var t in o)o[t].x=0,o[t].y=-1}var r,o={};for(r in t)o[r]=t[r]();var s=function(t,r,s,a,h,c){c||n();var l,d,u,f,g,A,p,m,v,k,b,y,w,B,C,G=new Array(s*a),R="evil"==h,I=999*(R?1:-1);for(l=0;s>l;l++)for(d=0;a>=d;d++)if(d==a||t.check(l,d)){for(u=d-4;d>u;u++)G[t.asIndex(l,u)]=u;break}var S=c===e?o:{cur:c};for(f in S){for(g=S[f],w=-999,A=0;A<(g.symmetrical?2:4);A++)for(p=g.getBlocks(A),m=g.getBounds(p),l=-m.left;l<s-m.width;l++)for(d=-1;d<a-m.bottom;d++)if(r(l,d+1,p,!0)){v=i(G,p,l,d,t,s,a),v>w&&(w=v,B=A,C=l);break}(R&&I>w||!R&&w>I)&&(k=g,I=w,b=B,y=C)}return k.best_orientation=b,k.best_x=y,k};return s.no_preview=!0,s},d=$canvas.get(0),u=d.getContext("2d"),f=this.options.blockWidth,g=Math.floor(this._$game.innerHeight()/this._$game.innerWidth()*f),A=this._$game.innerWidth(),p=this._$game.innerHeight(),m=Math.floor(A/f),v=2,k=!1;e(),t(window).resize(function(){e()});var b={line:function(){var t=[0,-1,0,-2,0,-3,0,-4],e=[-1,-2,0,-2,1,-2,2,-2];return new a([t,e,t,e],!0,"line")},square:function(){var t=[0,0,1,0,0,-1,1,-1];return new a([t,t,t,t],!0,"square")},arrow:function(){return new a([[0,-1,1,-1,2,-1,1,-2],[1,-2,1,-1,1,0,2,-1],[0,-1,1,-1,2,-1,1,0],[0,-1,1,-1,1,-2,1,0]],!1,"arrow")},rightHook:function(){return new a([[0,0,0,-1,1,-1,2,-1],[0,-2,1,0,1,-1,1,-2],[0,-1,1,-1,2,-1,2,-2],[0,-2,0,-1,0,0,1,0]],!1,"rightHook")},leftHook:function(){return new a([[2,0,0,-1,1,-1,2,-1],[0,0,1,0,1,-1,1,-2],[0,-2,0,-1,1,-1,2,-1],[0,0,0,-1,0,-2,1,-2]],!1,"leftHook")},leftZag:function(){var t=[0,0,0,-1,1,-1,1,-2],e=[0,-1,1,-1,1,0,2,0];return new a([e,t,e,t],!0,"leftZag")},rightZag:function(){var t=[0,-2,0,-1,1,-1,1,0],e=[0,0,1,0,1,-1,2,-1];return new a([e,t,e,t],!0,"rightZag")}},y=[];t.each(b,function(t,e){y.push(e)});var w={data:new Array(f*g),score:0,toClear:{},check:function(t,e){return this.data[this.asIndex(t,e)]},add:function(t,e,i){t>=0&&f>t&&e>=0&&g>e&&(this.data[this.asIndex(t,e)]=i)},asIndex:function(t,e){return t+e*f},asX:function(t){return t%f},asY:function(t){return Math.floor(t/f)},clearAll:function(){this.data=new Array(f*g)},_popRow:function(t){for(var e=f*(t+1)-1;e>=0;e--)this.data[e]=e>=f?this.data[e-f]:void 0},checkForClears:function(){var t,e,i,n,r=C.lines,o=[];for(t=0,e=this.data.length;e>t;t++)n=this.asX(t),0==n&&(i=0),this.data[t]&&"string"==typeof this.data[t]&&(i+=1),n==f-1&&i==f&&o.push(this.asY(t));for(t=0,e=o.length;e>t;t++)this._popRow(o[t]),C.lines++,C.lines%10==0&&C.dropDelay>1;var s=C.lines-r;this._updateScore(s)},_updateScore:function(t){if(!(0>=t)){var e=[0,400,1e3,3e3,12e3];t>=e.length&&(t=e.length-1),this.score+=e[t],this._$scoreText.text(this.score)}},_resetScore:function(){this.score=0,this._$scoreText.text(this.score)},draw:function(){for(var t,e=0,i=this.data.length;i>e;e++)void 0!==this.data[e]&&(t=this.asY(e),blockType=this.data[e],o(this.asX(e),t,blockType))}},B=l(b),C={animateDelay:1e3/this.options.speed,cur:null,lines:0,dropCount:0,dropDelay:5,init:function(){this.cur=this.nextShape();var t,e,s,a,h,c=[],l=[];for(l=Object.keys(b),t=0,e=f;e>t;t++)for(s=0,a=n([i(0,8),i(5,9)]);a>s;s++)h&&i(0,3)||(h=n(l)),c.push([t,g-s,h]);if(this.options.showFieldOnStart)for(r(),t=0,e=c.length;e>t;t++)o.apply(o,c[t]);this.showStartMessage()},showStartMessage:function(){this._$start.show()},showGameOverMessage:function(){this._$gameover.show()},nextShape:function(t){var e,i,r,o=this.next;if(e=b[G.mode]?b[G.mode]:"nice"==G.mode||"evil"==G.mode?B:n(y),e.no_preview){if(this.next=null,t)return null;if(i=e(w,h,f,g,G.mode),!i)throw new Error("No shape returned from shape function!",e);i.init(),r=i}else{if(i=e(w,h,f,g,G.mode),!i)throw new Error("No shape returned from shape function!",e);if(i.init(),this.next=i,t)return null;r=o||this.nextShape()}return k&&(B(w,h,f,g,"normal",r),r.orientation=r.best_orientation,r.x=r.best_x),r},animate:function(){var t=!1,i=!1;if(e(),!this.paused){if(this.dropCount++,(this.dropCount>=this.dropDelay||k)&&(t=!0,this.dropCount=0),t){var n=this.cur,o=n.x,s=n.y,a=n.getBlocks();if(h(o,s+1,a,!0)){t=!1;for(var l=0;l<n.blocksLen;l+=2)w.add(o+a[l],s+a[l+1],n.blockType),s+a[l]<0&&(i=!0);w.checkForClears(),this.cur=this.nextShape()}}u.clearRect(0,0,A,p),r(),w.draw(),this.cur.draw(t)}i?(this.options.onGameOver(w.score),k?c():(this.showGameOverMessage(),C.gameOver=!0)):window.setTimeout(function(){C.animate()},this.animateDelay)}},G={mode:this.options.difficulty,modes:["normal","nice","evil"],modesY:170,autopilotY:null,init:function(){this.mode=this.options.difficulty},setMode:function(t){this.mode=t,C.nextShape(!0)}};G.init(),C.init(),this.options.autoplay?(k=!0,c()):(t(document).keyup(function(t){return C.started||13!=t.keyCode&&32!=t.keyCode?!0:c(t)}),t(document).keyup(function(t){80==t.keyCode&&(C.paused=!C.paused)}),t(document).safekeypress(function(t){var e=!1;if(C.cur)switch(e=!0,t.keyCode){case 37:C.cur.moveLeft();break;case 38:C.cur.rotate(!0);break;case 39:C.cur.moveRight();break;case 40:C.dropCount=C.dropDelay;break;case 88:C.cur.rotate(!0);break;case 90:C.cur.rotate(!1);break;default:e=!1}return e&&t.preventDefault(),!e}))}})}(jQuery);/*!
 * BlockRain.js 0.1.0
 * jQuery plugin that lets you put a playable (and configurable) game of Tetris in your site or just leave it in auto in the background.
 * http://aerolab.github.io/blockrain.js/
 *
 * Copyright (c) 2015 Aerolab <hey@aerolab.co>
 *
 * Released under the MIT license
 * http://aerolab.github.io/blockrain.js/LICENSE.txt
 */
var BlockrainThemes={candy:{background:"#040304",backgroundGrid:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAABcVBMVEUZGRkaGhobGxsAAAAcHBwBAQECAgIZGhwLCwsYGBgZGxYXFxcGBgYZGh8ZGh4aGhwZGxoWFhYeHh4bGRwdHR0HBwcaGxYFBQUDAwMeGRYZHBMEBAQcHB4VFRUXGh8aGhgbGxkgGBYdGRgcGhsUFBQQEBAbGRoWHRYbGhYdGBwdGRYaGR4UGyEaGRcMDAwREhcgICAAAgcbGx0aHBkSFBEZGxgYGR0JCQkbGR4SEhIABAAfHx8XFxUBBAATFAwZGhQZHBUeGBgICAgAAAgQEBgDAwAUFAobGxMXGxoQEBIdGRogGBUHAgAYEw0eGxQeGhcZHBEZGSEHAAUYDxAeGhkWGyEWGx4WHBoGBggXHBYEAAcWDRIcFhYcGBcZGRcTHR4THhoUHhYXGxwCAwgBAAITDw4ZGBYWGx8SHB4SHRkTHRUWGxUACgYCBwMAAQAREg0FBwQKDRIJDRYHDxIJDw8KDwgNDggQDA0QCw8MCgsNDQ3RXB2UAAABG0lEQVR4XjWMU4+tQRRE9+7uj8ax7bFt27Zt3PvrpyeZsx6qkpVKARUFKlIqcCivqEBBoMHRqCw3cmQ5KHINITHPHETCQezDnCwC1eMuqSvmYzmueojjwB8OMCUKIjRrhDFGfsN1ma8LaJ4Bqa9Q0dAP2zMxX38qlbQtqZXwL1eHsfFOW41E1GkjYUqARPFDS5PZNrwcUSXDkBAJAz/0tneoaiCAXnc5UykQxlcDg0OBQ0TPK4+kww1INB0mJqdKWDWr3mx4jivkan5hcSlrrJhSslTJFAhRdFhdS69njY3NreKObSEhWhB29/YPIFE7Oj4pnkoWQjwEZ+cXl/ZV7frm9k6yYkBCFO4fHp+eX17f3j8+v77//ZcF4Qfd6yVhNO1A+QAAAABJRU5ErkJggg==",blocks:{line:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAIAAADZrBkAAAACuklEQVR4Xi2MzW4cRRSFz/2p6p4eT2zjjE2MHBQWvAALNjwDS8SOFc/FIyCxQgh2LFHkBQgJyQo/wXKCEZ7x9E9VV93LBPNJ516dxXfo/U8+HTZ9uzrZympTjLo4DbtDiBpXSBGMocI5lkaMhKv0fz+LVX9P6ZuvvxqBby+3L3eJu6Zt27DL4qgIWW0KsxPC3Kjxz5fPT3z48csvtHSHd0C/1374RddPX/9xK6JdcjEutNfqFJMBsQat3By+i/7VxqJ6c/zd5avvn1+N7dl2V9Ad92M2ViI2ksyWSJ2QXQXc5/H25jYcHHKl1YYebcJqw/rW03OOzfr89NHbR8vH3Wq9Olofrddni+XhycXJhBSkKFLxWeHBZFFDVyD343Rzc/0XeYSXeXZIJaam2V9pLsBOtRIKYAorXqvAg8giaKsCKw1zJAGFbKhwtxrdG9E3BQxAIW1xyYUKUIwNxMAwDEwuSgA5iAw2l5ITOeE/GLRMihIOsnQZnKqOlWXRUWidyYkFpCxtCF1s8D+seBggYVYRhChkqqjmld3NKhhu1XKuKUf4g6egEitkvqc5ewo+3ZOVZJO4Q4OSEDGRRyAQkYH8QfMUCR07KS8DIsO8xhjcnUXnSv4GMRYShSUG2MFCeby/awOJFyvF3TU22ckk3E3FQjci+mJVggwz12rKVEvWOk3dwWpIr7ezrU4XZ+9ciBAxWCVlhDb2o5cZTgBR17R3w45hgg8/fu+Dj643adZVXzCmebsbp5T6fhr2L9W8z5xLNsyDpl2btrsXPynS9NvVVc28xzMLPDCUYbVUMy+TMgdinupCEapdvPv0lqGwjW9fHsXjF39eIzRpnFbLdiy918qCWmclnq3mcWhVnzw5v+83XYz0+LPP/8lL704NB3BBdbCDKlChAq8QgRvmGSFouyo3vz7Lr/8FMHqie3VCpNQAAAAASUVORK5CYII=",square:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAIAAADZrBkAAAACfUlEQVR4Xh3LvY5cRRBA4VNV3ffe+fEaZARgWfBExEhEZEg8A69AgkC8AzEiICMgJCdAxggsGRuW3Z3dmenbXVWskT6d7MiXnz3qclu87esm1qW3NteRuqaCIAmQABwPvPU2NyeaUa6P159/9QV3l/HqlWqN41El0PaadEJAoZBKqS9+eybL/tvvvi8PrHA4ku33pz9v5rafKmc0I7QhbiGaJSikyeCh1T7OG6fMluOvP/5+8csb+/RxhUtlEXA5KUMpiEpWwZKU3D799Zl1CtpEjsoh++HRxUMBVhgry4yUXLvstnE8qWi/HZndTEwpppj5XLIg7fZ4+fJlb91jzSlGhjc2O7RMj995nApRIRW0BHRl9UXLona6PYiGGKpaa50qPtQ96/5BCgkpBKghpI7VJZK5bmYju5IxQkZONqtbu+txd5ZEQFI0KaRRJxEZY0wjh/dqKqbZ/z9tqmJIqpQSnaD8T9sYkGqWmuTIZHgoWYupKh4SqSQimqrJfeV1gTECF4NKmUHwDFRqNSuJjMTxFQANNKGUyTBxYqSX6J6USdc1BquYFhEMFEQCUvSeC5rheL/Y74kAvX/OPXRZojIkqHkaLpMwWdYJm1fHlZIJotdXN7tFtczvvfuB5MIyRZwQ11pora2BTKOvva3zPKtStpsKLNNmmcr53xtFMtLaGLSR61IKKaPHenO1L2+qThqrn5FvPuGjjz8s4x+NI6Ptdvtxckywo0cjstZZZfZhNhSWNuoPP/5Udhebc8+tbp4//zPd6dcaGtJtWtUiVkhTWSJkTn3y5P15M19ervL1p9UZFzX9zHYmO1Ph3KFQK+rkIBMScbY7DicOzn+QRoW5iamqhgAAAABJRU5ErkJggg==",arrow:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAIAAADZrBkAAAACsklEQVR4XhWPu25bVxREZz/OuQ9RVKhXjBSu8gX5h+QD0udD8ilByjRpUqZxa6RxY8DuYlhwHhAc2qRIieK9vOfsvUMNBoPVrGLoh6+++7y7mbFfTNIVdShCxCGuAgE8tSilhOVWU6lrtPjPK33ffvvb6xd4KG9/+f1kenIYoAgOIc+AF9u5Rdteuvubty9LU168fqW9z7AFanr36uPZSOIgWHB1IJABKE0keSr3QdLolXitjw1n717++sfPP/7Ula6pfbYmeU7eaBybnzg6ewwpT8DW/vth2acFkzf9Pi0OOU1+/eVlM2/m14vZ+Rfz88t+Np+fnZ8tns1OL66vLss0FIughgppDumLzIpmYBrHz+uVsZVSsraorJoMQU5dOs3K3jaiSXGciNYoG3cQcbJjwiKC3Ny9ljhEEUlGBnh4IJwR+qQ6q7FbuMPBLEQCVjaYA0mYwcyIY6p5qYFQQqOexRMhHOqg6sV8mtiqQki51gSHV6YAMYMMxgIC2IOcBcIsQipBBCIjNqEQBWARjjAOHAtSh1eqk9bqLpBKQUSZE4ccIqpJFnWQiRSKypjUA1DgEDw5janNkgA4zKmGQtpgsNqhMoRCmRni4AgKJh6DB842TffENWWqU+m448eYje186GZT31nXo5EqPhUGIqoGwd1gtWFtRBeLxcXF1TydYh+td1E5lMdpOOxGr9bPOzdrtFGWk2lAg84e9/fYbGmsync0xD7mfkITgUMbJaKc26GOVn2sB61Gf958OE992wsoQjSSjBHUwEmlISTsxjEsOIsxP3v+/M3tey3wrRVh29wuA2Vo3Xoe3KP6Endhzh3v92NjKefcXZzETKxR+Sa+vt2s3/3z127YrYfN+mGz2m4+rT+tNuu77d3yfvn3+vbh8eH4bb3dLrer97c3q7L6H15gvODKB5u4AAAAAElFTkSuQmCC",rightHook:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAIAAADZrBkAAAACqElEQVR4Xh3PO2tlZRSH8f9a73XvPTkTExl1dLAIKFpNY2Fl4UcT7G3FwmIaO3sbEfQjWAxDAkIORDHJyXFf3stayzC/9qke+ubrF0u7zqwfsJNFXEKtCAJriBGBoB0gNAZ5WIekcC0f+br8++3Pr1AP5Y/f6Xgfx4RqoB2kI27QgkYQw5BA2L95M+vTn379y0c2HI+Y5Ob6z3B/M/ZmlTieV7ISj9rXZ2n338NciEMedGshJacbZ9X16vK3H76vh/1paCOWiWvos5M1U9llLIebKeqz0zG4PmZ/dfl6XWc/9p4Ox/fMwnIcXrwL6ohPg54OZhYTUUc+w1YQ83z3kMadEKdp8EmE54cnKifTBLOr17cqtwIf4gAuKhUd8Lh4+TKPowjyOK1l8cxAm9nK2nWnsQeAyNtgldnClCLntkrRrTBcFyPjYRg8AEAY4JDhkhp7uOBIRbyqrmK+KcBm1qU30UbSxHcGnIGpKYk63dQxnC2sPcWo2slZUCCGYXPkkBnUqjcCSAGFsaOUQk5koqUqPFV5G2sDai+tG3vv6ZF3BojBzFrvpeij4KtDZTjPXTWGBA91uWJTo1WkqTAZoAbpT3ejd0YOBW1zoAHE/tG8FThm52KOLnDv1dA8DACTwbRU6TxSaX1WZII/1qBgwLvWtgN6ieQc2hC9hwLGTFS35eTJ7uOL5xxTkZI44l7BDGpwBke8FFCA9Pj2EAipHbd8Qre3fxOMDWykGryyM2Vv67JwmCJ7cQRRM6JXX+CrLz97/uHJ4bgHFUdKBi8B5gECLLAys4grAkr5Vt758ZdLTwhuPNvfHP7ZPzjrBAHYLBlChwPQ+jrtpq2UJv3i0/clni/Y03efYzxPvZdBkAzeAKATukENAoTA86ynZ3GrVQl3Eu/yJ/8D33mmeKR3Cz8AAAAASUVORK5CYII=",leftHook:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAIAAADZrBkAAAACq0lEQVR4Xg3HO24mVRBH8X/Vrfv4ut02BjS8GSBAQuyCmE0gwSLICFgCBLASAhLiiQjQICFBMAMSFn63v+77qCp89EsO5U+/rus/0zQPPW8thXRQABLAjtHAAZ2gzGk2HRCG1YMPwgdf/fnXj1fX+O7732s/A0kzbwEUCW5Fgh8HGVdFTOn5H79NiZ/98rPATBVS8OzX5xTehYsxd3KFwXcGEljVOGVJ8a7W4Q4YT8sb33z70xdf/oB8HufzhjI0m2a3JLykuAyV4RGxrLVN5+f/3dxSKXJc59qfUk77djhdXhGx0/mMAg/rpm30bXq97Fp3su1mrMe19e46BLLw9Nb1w0WaZoO+fPmCNbTW3D1Fcjci77Cnn3wMhCBpWU7vuwqo3evgaar6QHRqfRXKhQiELFG1O6H3MZUyLpTIx24UMkNASbqZwZiN3AQsgKhZ6/VYR9OcDw/blg5xmKqPnIRBLQUZw4iIWQKydRcEcvLOOZ2A80Nv8SRv1iiHQWPXewbztm3MbObMYgpGCMwiwgwAIhJCAGBmjMD+KDJJThJzTI8TKZm5E9S7U3c0s6PrkVujvYbm0Qr1iceJ+GZ9772OMawNDNAgVm8cADcAQSgzCSiChZj8MRLwXCTPufQEC8SlVKPWNTJJ4BTDcds58tCaMsVoIQ8Nq2AgS97uVg2h7v29Dz86W86MGqB922F+djjsdbWE0eu233fbwF0opd57KYU43l5ewQ43N7d17CwUHJnlsl4QmUwkJJKZ5uXaLdBrnzl6EGbTbV2nVIiMuMU44EMwMjn76GMHeWAKhKuLvyXoC+F3IvXrfy9zmO/WKyUM6c1riWUY7btKiA+9UkyvPnk7KFMPtLz/uS9vrjVFLNqTUSEJNLN5hQL7gIXpsGytO0ekCduR/fg/hV+olVqSm3YAAAAASUVORK5CYII=",rightZag:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAIAAADZrBkAAAACt0lEQVR4Xg3LOW6eVRQG4PcM937DP9hYlkgUQ6RQsAiEWAC7YCWUtGyAFqhpEHRI0CCBIjpHJBSxEhzkxP6H+93pHPz0D3358IsbuyY/XlCs7/YU5zjFZgdGp07BEDq4KXwA0PvuqIfDGbT0u69/+hZvr/DrH1gc1WENwUAGM3RDcXQGRbA9/e3nJPX3F5dqdY/ja8ztx++/+YhX5S6P47REODW2Pra+qsbOR5VFWwjHVPKJJF1FevPn019++O7jeYo3h5VG8Ua5OLnCh25T7+RwYfZavVz993q5OehccfImnV3nqdLjD54gTiDAF3cnEJrBAbZNSS//vTKP1FcTk0ppsfYzkpEt58Pls8vb29vTabDWYZJzjsqnJ+vHjx9tVvf3qG3QVpXJ0Y5L2xWmYbPt7W5WeK7RKUqICic7poQY6q4Fw2AUDSykUGUlQ0cUy3XUqCxm8Obe4SypVoRwOC7kLE5szIoBHsmlO6NJO3Qv5GEozI3IiE25K2EeLAiYADiBOwi51NLdCRrGcQ5xTLVUcg1BVeFszXtaWinkIAcALigQDwISby0Vq3dpR8IA2r1cKNfZRTq9F2c1iLuYqQcHg2Dmvbam08QUG1V07zASqDCLouSSE0tojCbGablFoMgkpMxht9QukvICASIXtNLy7rDDakVDeGepzpIUup1mlIZs5Dbo9OknnwEELGgZJgBhHHDYIx/v8/r98+d/P2cVVSOkitRPN9uXfz0j2rRSh1CZDKRmFomgnns62Wyvrq+ncTy2JJ/rRXv76vx04ymr83pci9gYRYISS4N3cgRKvYb15EHOHzy8fPaPgtMe8zHG5y8uH6y3wa7LPbNOIIkQRpCOZt7KzatHFx+Ww0Ki9NX8ZHWy7Sltchtz2aj32nicjZkpLr1m760vp5tN2e8jtHX0Yf4f3da+1L4oEEQAAAAASUVORK5CYII=",leftZag:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAIAAADZrBkAAAACtElEQVR4Xg2Lu25cZRhF93f5L3OOPeOQmJuDhEIHDa/CC/B4SHSICqS0CERDE2MJAYKEmITEcewZz/nvH7O0taq16eTL++P66nhCDegOAEhghFYhDDM0hSgowQkKkDIwJi0pP/72G9j24vIi8S7nN34lYG1VyOKg0uVKFFIiY/XL+R8s977+6nvttBMkovTDz9/Np3G3fTlvYkoFJswzaxtya2haQ0nUdGa2PLY6GD/9+vjJ+Y+bD+K2vFxtrLS3cQq9t1rLwUZ7IpuOAmQQ8u9/PgFDWbG5708/jK/Ti9OzExErhYVU1TMrCZqV7fY2Or2+uQ5H7zgPMNQF5HL7+upZeFeHLU//etrraM2YedQBAXsnoPXHn8yrcHVzE0LICWoECTQf+SG19dRqK3tMUxSRZtkIZtqbsblW+vF8/Pzy1XoNvdthjDas7He7swdno+JkM21v997r6A1MIKNBwiCiXssqhNsbcAwQosPTeek1MzBa947NmnewYcGR8Oh1sZG8s5LvQoACaK0Yegi+965MNWXnxIAx0AdyWnqDMjuh1KoIkYGNUPqh0zHaYcpwoin1ZiBFjFBVEWLm1ppzTkQAsAQYQdwhTap+dBCRXzkW6g2lIpdqRkYE1v1+AZgEuiRo8G2YaCBo75ZylSCdiMnoYPVefO1k8AYm7rlAjUDi7/ZN18HIffbp5zFO22Vf0bzXfsBQUu4DIJ6P1/t/XowB9RGl4Xj94M62zy+vou2sDUySyhJjTDXpAeL9YFKXaxYnuoL2BRfnzxghj7YKm4liHkszGkOUjtxIYjKM9ncpTnPr4+HDj8j+U5/B5R5k/vfv344m6rfXHb3NSqKvdrs5xKUWeN95nUd69Oi9vpQI0PtfTAn7eE/eLF0Y92eUjrcDISBmrBjbgkrIDPFYCfoCLPgflXOjuIEFgMYAAAAASUVORK5CYII="}},modern:{primary:null,secondary:null,stroke:null,blocks:{line:"#fa1e1e",square:"#f1fa1e",arrow:"#d838cb",rightHook:"#f5821f",leftHook:"#42c6f0",rightZag:"#4bd838",leftZag:"#fa1e1e"}},retro:{primary:null,secondary:null,stroke:"#000000",innerStroke:"#000000",blocks:{line:"#fa1e1e",square:"#f1fa1e",arrow:"#d838cb",rightHook:"#f5821f",leftHook:"#42c6f0",rightZag:"#4bd838",leftZag:"#fa1e1e"}},monochrome:{primary:"#ffffff",secondary:"#ffffff",stroke:"#000000",innerStroke:"#000000"},aerolab:{primary:"#ff7b00",secondary:"#000000"},chocolate:{primary:"#7B3F00",secondary:"#7B3F00",stroke:"#291811",innerStroke:"#291811"},gameboy:{background:"#C4CFA1",primary:null,secondary:null,stroke:"#414141",innerStroke:"#414141",innerSquare:"#000000",blocks:{line:"#88926A",square:"#585E44",arrow:"#A4AC8C",rightHook:"#6B7353",leftHook:"#6B7353",rightZag:"#595F45",leftZag:"#595F45"}},vim:{background:"#000000",primary:"#C2FFAE",secondary:"#C2FFAE",stroke:"#000000",strokeWidth:3,innerStroke:null}};